<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>割り算トレーニング</title>
  <style>
    :root{--bg1:#a8edea;--bg2:#fed6e3;--accent:#3ca6ff;--good:#00b894;--bad:#e63946}
    html,body{height:100%;margin:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));-webkit-font-smoothing:antialiased}
    .container{
      width:95vw;max-width:480px;margin:0 auto;padding:18px;border-radius:18px;background:rgba(255,255,255,0.95);box-shadow:0 8px 25px rgba(0,0,0,0.12);display:flex;flex-direction:column;align-items:center}

    /* difficulty info */
    .diffWrap{width:100%;margin-bottom:14px;display:flex;flex-direction:column;gap:8px}
    .diffLabel{display:flex;justify-content:space-between;align-items:center;font-weight:800;color:#234};
    .levelText{font-weight:900;color:var(--accent);font-size:16px}
    #difficultySlider{width:100%;-webkit-appearance:none;height:14px;border-radius:8px;background:#d6d6d6;outline:none}
    #difficultySlider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:36px;height:36px;border-radius:50%;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.18)}
    #difficultySlider::-moz-range-thumb{width:36px;height:36px;border-radius:50%;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.18)}
    .ticks{display:flex;justify-content:space-between;font-size:12px;color:#6b7280;margin-top:6px}

    .question{font-size:3rem;font-weight:800;color:#0b1720;margin:6px 0 14px;text-align:center}
    .input-box{width:100%;text-align:center;padding:12px;font-size:2.0rem;border:2px solid rgba(0,0,0,0.06);border-radius:12px;background:linear-gradient(180deg,#fbfeff,#f2fbff);margin-bottom:18px}

    .keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;width:100%}
    .btn{background:#fff;border:2px solid #e7eef8;border-radius:16px;padding:20px 0;font-size:1.9rem;font-weight:900;color:#0b1720;box-shadow:0 6px 14px rgba(6,12,24,0.06);cursor:pointer;transition:transform .12s ease}
    .btn:active{transform:translateY(3px)}
    .btn.rem{background:linear-gradient(180deg,#d3fbe8,#b7f1da);color:#046a4a}
    .btn.del{background:linear-gradient(180deg,#ffd6cc,#ffb8a3);color:#7a2b0d}
    .btn.ok{grid-column:span 3;background:linear-gradient(180deg,#9bd7ff,#3ca6ff);color:#042b45;font-size:1.8rem}

    /* centered overlay */
    .overlay{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);pointer-events:none;z-index:30}
    .oval{position:absolute;width:58vmin;height:58vmin;border-radius:999px;background:radial-gradient(circle at 35% 30%, rgba(255,255,255,0.95), rgba(0,200,120,0.22) 12%, rgba(0,160,95,0.06) 45%, rgba(0,160,95,0) 100%);filter:blur(6px);opacity:0;transform:scale(0)}
    .oval.show{animation:ovalIn 1.2s cubic-bezier(.16,.9,.3,1) forwards}
    @keyframes ovalIn{0%{transform:scale(.2);opacity:.12}45%{transform:scale(1.05);opacity:1}100%{transform:scale(1.9);opacity:0}}
    .mark{position:absolute;font-size:12vmin;left:50%;top:50%;transform:translate(-50%,-50%) scale(0);opacity:0}
    .mark.good{color:var(--good)}.mark.bad{color:var(--bad)}
    .mark.showGood{animation:markGood 1s ease forwards}
    .mark.showBad{animation:markBad .9s ease forwards}
    @keyframes markGood{0%{transform:translate(-50%,-50%) scale(0);opacity:0}50%{transform:translate(-50%,-50%) scale(1.3);opacity:1}100%{transform:translate(-50%,-50%) scale(1);opacity:1}}
    @keyframes markBad{0%{transform:translate(-50%,-50%) rotate(0deg) scale(0);opacity:0}60%{transform:translate(-50%,-50%) rotate(360deg) scale(1.2);opacity:1}100%{transform:translate(-50%,-50%) rotate(540deg) scale(1);opacity:0}}

    /* small screens adjust */
    @media(max-width:420px){.question{font-size:2.4rem}.input-box{font-size:1.8rem}.btn{font-size:1.6rem;padding:18px 0}.mark{font-size:10vmin}}
  </style>
</head>
<body>
  <div class="container">
    <div class="diffWrap">
      <div class="diffLabel">
        <div>難易度</div>
        <div class="levelText" id="levelText">普通</div>
      </div>
      <input id="difficultySlider" type="range" min="0" max="100" value="0">
      <div class="ticks"><span>やさしい</span><span>普通</span><span>難しい</span><span>激ムズ</span></div>
    </div>

    <div id="question" class="question">-- ÷ -- = ?</div>
    <input id="answer" class="input-box" readonly>

    <div class="keypad" id="keypad">
      <!-- buttons injected -->
    </div>
  </div>

  <div class="overlay" aria-hidden="true">
    <div id="oval" class="oval"></div>
    <div id="goodMark" class="mark good">◯</div>
    <div id="badMark" class="mark bad">✖</div>
  </div>

<script>
  const slider = document.getElementById('difficultySlider');
  const levelText = document.getElementById('levelText');
  const keypad = document.getElementById('keypad');
  const questionEl = document.getElementById('question');
  const answerEl = document.getElementById('answer');
  const oval = document.getElementById('oval');
  const goodMark = document.getElementById('goodMark');
  const badMark = document.getElementById('badMark');

  // difficulty: 0..9
  let difficulty = 0;
  slider.addEventListener('input', ()=>{
    const v = parseInt(slider.value);
    difficulty = Math.floor(v/10);
    updateSliderVisual(v);
    updateLevelLabel();
    // immediate change (no animation)
    generateQuestion();
  });

  function updateSliderVisual(v){
    // colored fill to show meaning
    const percent = v;
    slider.style.background = `linear-gradient(90deg,#bfe7ff ${percent}%, #e6e6e6 ${percent}%)`;
  }

  function updateLevelLabel(){
    if(difficulty <= 2) levelText.textContent = 'やさしい';
    else if(difficulty <=5) levelText.textContent = '普通';
    else if(difficulty <=7) levelText.textContent = '難しい';
    else levelText.textContent = '激ムズ';
  }

  function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a }
  let current = {a:0,b:0,q:0,r:0};

  function generateQuestion(){
    const d = difficulty;
    // choose divisor
    let b = randInt(2,9);
    if(d >= 5) b = randInt(10,99);
    if(d >= 8) b = randInt(12,99);

    if(d <= 3){
      // easy: divisible small
      const q = randInt(2,19);
      const a = b * q;
      current = {a,b,q,r:0};
    } else if(d <=6){
      // normal: mixed moderate
      if(Math.random() < 0.5){ const q = randInt(2,12); const a = b*q; current={a,b,q,r:0}; }
      else { const a = randInt(50,199); const q = Math.floor(a/b); const r = a%b; current={a,b,q,r}; }
    } else if(d <=8){
      // hard: larger numbers, more remainders
      if(Math.random() < 0.3){ const q = randInt(10,30); const a = b*q; current={a,b,q,r:0}; }
      else { const a = randInt(200,799); const q = Math.floor(a/b); const r = a%b; current={a,b,q,r}; }
    } else {
      // extreme
      const a = randInt(300,1499); const q = Math.floor(a/b); const r = a%b; current={a,b,q,r};
    }
    questionEl.textContent = `${current.a} ÷ ${current.b} = ?`;
    answerEl.value = '';
  }

  // build keypad in desired layout (1..9 top-left -> 0 centered below 8)
  const keys = ['1','2','3','4','5','6','7','8','9','⌫','0','OK'];
  keys.forEach(k=>{
    const btn = document.createElement('button'); btn.className='btn'; btn.textContent=k;
    if(k==='⌫') btn.classList.add('del');
    if(k==='OK') btn.classList.add('ok');
    btn.addEventListener('click', ()=> handleKey(k));
    keypad.appendChild(btn);
  });
  // add あまり button below as full-width small button
  const remBtn = document.createElement('button'); remBtn.className='btn rem'; remBtn.textContent='あまり'; remBtn.style.gridColumn='span 3'; remBtn.addEventListener('click', ()=> handleRem()); keypad.appendChild(remBtn);

  function handleKey(k){
    if(k==='⌫'){ answerEl.value = answerEl.value.slice(0,-1); return }
    if(k==='OK'){ checkAnswer(); return }
    answerEl.value += k;
  }
  function handleRem(){ if(!answerEl.value.includes('あまり')){ if(answerEl.value && !/\s$/.test(answerEl.value)) answerEl.value += ' '; answerEl.value += 'あまり '; } }

  // answer check with proper remainder handling
  function checkAnswer(){
    const raw = answerEl.value.trim();
    if(!raw) return;
    if(current.r === 0){
      // must answer quotient only (or quotient あまり 0)
      const num = Number(raw.replace(/[^0-9\-]/g,''));
      if(!Number.isNaN(num) && num === current.q){ showGood(); } else { showBad(); }
    } else {
      // remainder exists -> require format "q あまり r" or variants
      const m = raw.match(/(-?\d+)\s*(?:あまり|r|R)?\s*(\d+)/);
      if(m){ const q = Number(m[1]); const r = Number(m[2]); if(q===current.q && r===current.r){ showGood(); } else { showBad(); } }
      else { showBad(); }
    }
  }

  function showGood(){ oval.classList.remove('show'); goodMark.classList.remove('showGood'); void oval.offsetWidth; oval.classList.add('show'); goodMark.classList.remove('showBad'); void goodMark.offsetWidth; goodMark.classList.add('showGood'); setTimeout(()=>{ goodMark.classList.remove('showGood'); oval.classList.remove('show'); generateQuestion(); }, 900);
  }
  function showBad(){ badMark.classList.remove('showBad'); void badMark.offsetWidth; badMark.classList.add('showBad'); setTimeout(()=>{ badMark.classList.remove('showBad'); generateQuestion(); }, 900);
  }

  // update initial visuals and start
  updateSliderVisual(parseInt(slider.value)); updateLevelLabel(); generateQuestion();

  /* accessibility: let "r" key insert あまり when appropriate */
  window.addEventListener('keydown', e=>{
    if(e.key === 'Enter') checkAnswer();
    else if(e.key === 'Backspace') answerEl.value = answerEl.value.slice(0,-1);
    else if(/^[0-9]$/.test(e.key)) answerEl.value += e.key;
    else if(e.key.toLowerCase() === 'r') handleRem();
  });
</script>
</body>
</html>
